# Documentation - Bread Board PBX (BB_PBX)

This simple telephone Private Branch Exchange (PBX) uses ready made modules:

* [Subscriber Line Interface Circuit (SLIC)](/docs/Ring_SLIC_Interface.pdf)
* [PSTN Interface circuit](/docs/RT03106_Ag2120-datasheet-PSTN-interface.pdf) & [Schematic Drawing](/docs/RT03106_schem.jpeg)
* [Audio WAV/MP3 players](/docs/KOOBOOK_SD_Audio_player.pdf)
* [DTMF decoder module](/docs/MT8870.jpg)
* [Relay Board](/docs/4DPDT_Relay_board.jpeg) & [Schematic Drawing](/docs/4DPDT_Relay_board_schem.jpeg)


The modules are connected to a Micromite PIC32 microcontroller that is running an embedded BASIC called MMBasic.

* Micromite - https://geoffg.net/micromite.html
* [MMBASIC PIC32 Schematic](/docs/PIC32MX170F256B_drawing.jpeg)
* PICAXE 8 pin microcontroller ring generator

Due to the amount of I/O pins needed to control the modules the Micromite PIC32 microcontroller can support just two extentions (SLICs) and one PSTN module.
An I/O extender could be used in the future.

## Features

* Pulse rotary dialing
* Two Extensions
* One Public Switch Telephone Network port (to connect to the world)
* Progress Tones presented to the two extensions (dialtone, ringing, etc.)
* Extension can dial and ring each other by using an assigned extension number
* Simple ring generator using a PICAXE 8 pin microcontroller dedicated to each SLIC using only a single I/O pin and no software on the PIC32

## Description

With two (2) SLICs and one (1) PSTN module the system is fairly simple. The SLICs have to be monitored by the microcontroller to detect when a phone goes offhook, etc. It was decided to attempt to do the control software without the use of interrupts. MMBASIC does support interrupts but they are not used at this time. The system design philosophy is keep everything modular and have each system block do as much as possible. For example, progress tones in the system are generated by a SD Card based MP3/Wave player, this avoids burdening the microcontroller from generating tones and with recordings, we can generate authentic tones like, the "old time" dialtones along with actual voice messages. Using the I/O pins on the microcontroller to the SD Card player, we can just set the bit pattern to play the required file, and the player will continue to play that file until told to stop.

Things start to get complicated when we want two phones to be able to talk to to each other and setting up the ringing of each phone. There are many decisions that need to be made in terms of the number of voice paths in the system and the number of extension and how many calls that can be in-progress at the same time. Since this system is limited to just two (2) extensions we are using a very simple "switch fabric" that consists of just relays and direct wire paths (see the Basis Switch Fabric below).

The basic switch fabric contain just two (2) audio paths, so this limits how many functions that can happen at one time. For example if extension 1 goes offhook it gets dialtone, if extension 2 goes offhook after that, at the same time, there will be no dialtone and a dead line. This because of the limited switch fabric with just one SD Card player (tone generator) and audio path. Telephones connected to the SLIC can talk to another phone connect to a SLIC via IN/OUT audio pins. The In from one SLIC goes to the Out and vice versa of the other SLIC. This cross connection is provided with audio path B in the basic switch fabric with just a coupling capacitor in each line of the cross connection.

## Block Diagram

![Alt text](../images/BB-PBX.png?raw=true "Block Diagram")

## Basic Switch Fabric

![Alt text](/docs/BB-PBX-Relay-Fabric.png "Fabric")
